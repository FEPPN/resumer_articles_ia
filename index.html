<!-- ðŸ”¹ Papernest â€“ RÃ©sumÃ© IA compact (fond violet) -->
<div class="ppn-ai-strip" role="region" aria-label="RÃ©sumÃ© d'article via IA">
  <p class="ppn-ai-strip__title">
    <strong>Article trop long&nbsp;?</strong> Demandez un rÃ©sumÃ© Ã  lâ€™IA&nbsp;:
  </p>

  <div class="ppn-ai-strip__logos">
    <!-- ChatGPT -->
    <button class="ppn-ai-logo" data-target="chatgpt" title="Ouvrir ChatGPT">
      <img alt="ChatGPT" src="https://raw.githubusercontent.com/FEPPN/resumer_articles_ia/refs/heads/main/chatgpt-6.svg">
    </button>

    <!-- Claude -->
    <button class="ppn-ai-logo" data-target="claude" title="Ouvrir Claude">
      <img alt="Claude" src="https://raw.githubusercontent.com/FEPPN/resumer_articles_ia/1b694246d10d428d5464dacf3cbf866844d95861/Claude_AI_symbol.svg.png">
    </button>

    <!-- Mistral -->
    <button class="ppn-ai-logo" data-target="mistral" title="Ouvrir Mistral">
      <img alt="Mistral" src="https://raw.githubusercontent.com/FEPPN/resumer_articles_ia/1b694246d10d428d5464dacf3cbf866844d95861/Mistral_AI_logo_(2025%E2%80%93).svg.png">
    </button>

    <!-- Microsoft Copilot -->
    <button class="ppn-ai-logo" data-target="copilot" title="Ouvrir Copilot">
      <img alt="Copilot" src="https://raw.githubusercontent.com/FEPPN/resumer_articles_ia/1b694246d10d428d5464dacf3cbf866844d95861/Microsoft_Copilot_Icon.svg.png">
    </button>
  </div>

  <span class="ppn-ai-toast" aria-live="polite" hidden>âœ… Prompt copiÃ© â€” collez (âŒ˜/Ctrl+V)</span>

  <!-- Fallback manuel si la copie auto Ã©choue -->
  <dialog class="ppn-ai-dialog" id="ppnPromptDialog">
    <h4 style="margin:0 0 8px 0;">Prompt Ã  coller dans lâ€™IA</h4>
    <textarea id="ppnPromptText" readonly rows="10" style="width:100%;border:1px solid #e5e7eb;border-radius:8px;padding:10px;"></textarea>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px;">
      <a id="ppnOpenIA" class="ppn-ai-link" href="#" target="_blank" rel="noopener">Ouvrir lâ€™IA</a>
      <button id="ppnSelectAll" type="button">SÃ©lectionner tout</button>
      <button id="ppnCopyManual" type="button">Copier</button>
      <button id="ppnCloseDialog" type="button">Fermer</button>
    </div>
    <p style="margin-top:8px;font-size:.9rem;color:#6b7280;">Puis utilisez <strong>âŒ˜/Ctrl + V</strong> dans lâ€™IA.</p>
  </dialog>
</div>

<style>
:root{
  --ppn-primary:#5A52FF;  /* violet Papernest */
  --ppn-bg:#F3F4FF;       /* fond violet trÃ¨s clair */
  --ppn-text:#0b0f19;
  --ppn-radius:20px;
  --ppn-shadow:0 8px 24px rgba(11,15,25,.06);
}

.ppn-ai-strip{
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:var(--ppn-bg);
  border:1px solid rgba(90,82,255,.18);
  border-radius:var(--ppn-radius);
  padding:18px 20px;
  box-shadow:var(--ppn-shadow);
  max-width:760px;
  margin:0 auto;
  text-align:center;
}
.ppn-ai-strip__title{margin:0 0 12px 0;color:var(--ppn-text);font-size:1.05rem;font-weight:700;}

.ppn-ai-strip__logos{display:flex;justify-content:center;gap:14px;}
.ppn-ai-logo{
  background:#fff;border:1px solid rgba(11,15,25,.10);
  width:44px;height:44px;border-radius:999px;padding:8px;cursor:pointer;
  display:inline-flex;align-items:center;justify-content:center;
  transition:transform .08s ease, box-shadow .12s ease, border-color .12s ease;
  box-shadow:0 2px 8px rgba(11,15,25,.06);
}
.ppn-ai-logo:hover{box-shadow:0 6px 16px rgba(90,82,255,.25);border-color:rgba(90,82,255,.35);}
.ppn-ai-logo:active{transform:translateY(1px);}
.ppn-ai-logo img{width:100%;height:100%;object-fit:contain;}
.ppn-ai-toast{display:block;margin-top:10px;font-size:.9rem;color:#136f2d;}

@media (max-width:560px){ .ppn-ai-logo{ width:40px; height:40px; padding:7px; } }

/* Dialog fallback */
.ppn-ai-dialog::backdrop{ background: rgba(0,0,0,.25); }
.ppn-ai-dialog{
  border: 1px solid rgba(11,15,25,.12);
  border-radius: 14px;
  padding: 16px;
  max-width: 680px;
  width: min(92vw, 680px);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
}
.ppn-ai-dialog button,
.ppn-ai-link{
  background:#fff;border:1px solid rgba(11,15,25,.12);border-radius:8px;padding:8px 10px;cursor:pointer;text-decoration:none;color:var(--ppn-text);
}
.ppn-ai-dialog button:hover,.ppn-ai-link:hover{ border-color: rgba(90,82,255,.35); box-shadow: 0 2px 8px rgba(90,82,255,.2); }
</style>

<script>
(function(){
  // ------- Prompt "intelligent" Papernest (URL + titre auto) -------
  function buildPrompt(){
    const url = window.location.href;
    const domain = new URL(url).hostname.replace(/^www\./,'');
    const pageTitle = (document.title || '').trim();

    return `Tu es un assistant Ã©ditorial pour Papernest.
Lis l'article Ã  l'URL ci-dessous (si tu n'y as pas accÃ¨s, demande-moi de coller le texte) et produis un rÃ©sumÃ© utile pour lâ€™internaute.

Exigences de sortie :
1) TL;DR en 1-2 phrases.
2) 5 Ã  7 points clÃ©s avec chiffres/dates/variations (%/â‚¬/kWh) quand ils existent.
3) â€œCe que Ã§a change pour vousâ€ : 2-3 phrases actionnables pour le consommateur.
4) Si pertinent, propose jusquâ€™Ã  trois articles connexes UNIQUEMENT du mÃªme domaine (${domain}) ; sinon indique â€œAucun article connexe certainâ€.
5) Ajoute un avertissement si certaines infos sont susceptibles dâ€™Ã©voluer.
6) Garde Papernest comme source principale si une attribution est nÃ©cessaire.
7) Fournis un Title SEO (â‰¤60 car.) et une Meta description (â‰¤155 car.).

Titre dÃ©tectÃ© : ${pageTitle || 'â€”'}
URL : ${url}
Domaine : ${domain}`;
  }

  // ------- Ouvertures des IA -------
  const routes = {
    chatgpt: () => "https://chat.openai.com/",
    claude:  () => "https://claude.ai/new",
    mistral: () => "https://chat.mistral.ai/chat",
    copilot: () => "https://copilot.microsoft.com/"
  };

  // ------- Copie + fallback dialog -------
  const toast = document.querySelector(".ppn-ai-toast");
  const dlg = document.getElementById("ppnPromptDialog");
  const dlgText = document.getElementById("ppnPromptText");
  const dlgSelect = document.getElementById("ppnSelectAll");
  const dlgCopy = document.getElementById("ppnCopyManual");
  const dlgOpen = document.getElementById("ppnOpenIA");
  const dlgClose = document.getElementById("ppnCloseDialog");

  async function copyToClipboard(text){
    try{
      // tentative moderne
      await navigator.clipboard.writeText(text);
      return true;
    }catch(e){
      // fallback execCommand
      try{
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.setAttribute('readonly','');
        ta.style.position='fixed'; ta.style.top='-9999px';
        document.body.appendChild(ta);
        ta.select();
        const ok = document.execCommand('copy');
        document.body.removeChild(ta);
        return ok;
      }catch(err){
        return false;
      }
    }
  }

  function showToast(msg, ms=1800){
    if(!toast) return;
    toast.hidden = false; toast.textContent = msg;
    setTimeout(()=> toast.hidden = true, ms);
  }

  document.querySelectorAll(".ppn-ai-logo").forEach(btn=>{
    btn.addEventListener("click", async ()=>{
      const target = btn.getAttribute("data-target");
      const prompt = buildPrompt();
      const iaURL = (routes[target]||routes.chatgpt)();

      const copied = await copyToClipboard(prompt);
      if(copied){
        showToast("âœ… Prompt copiÃ© â€” collez (âŒ˜/Ctrl+V)");
        window.open(iaURL, "_blank", "noopener");
      }else{
        // Fallback : on affiche le prompt + actions
        if(dlg && typeof dlg.showModal === "function"){
          dlgText.value = prompt;
          dlgOpen.href = iaURL;
          dlg.showModal();
          dlgText.focus(); dlgText.select();
        }else{
          alert("Copie automatique impossible. Le prompt va sâ€™afficher pour copie manuelle.");
          console.log(prompt);
          window.open(iaURL, "_blank", "noopener");
        }
      }
    });
  });

  // Actions du dialogue
  if(dlgSelect){
    dlgSelect.addEventListener("click", ()=>{
      dlgText.focus(); dlgText.select();
    });
  }
  if(dlgCopy){
    dlgCopy.addEventListener("click", async ()=>{
      const ok = await copyToClipboard(dlgText.value);
      showToast(ok ? "âœ… Prompt copiÃ©" : "â„¹ï¸ Impossible de copier automatiquement");
      if(ok) dlg.close();
    });
  }
  if(dlgClose){ dlgClose.addEventListener("click", ()=> dlg.close()); }
})();
</script>
